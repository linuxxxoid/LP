parent('Yaroslav Veltman', 'Lina Veltman').
parent('Tatyana Romanenko', 'Lina Veltman').
parent('Yaroslav Veltman', 'Velizar Veltman').
parent('Tatyana Romanenko', 'Velizar Veltman').
parent('Victor Romanenko', 'Tatyana Romanenko').
parent('Zoya Maslenkova', 'Tatyana Romanenko').
parent('Pavel Veltman', 'Yaroslav Veltman').
parent('Natalya Utkina', 'Yaroslav Veltman').
parent('Pavel Veltman', 'Elena Veltman').
parent('Natalya Utkina', 'Elena Veltman').
parent('Ivan Utkin', 'Natalya Utkina').
parent('Nina Kovaleva', 'Natalya Utkina').
parent('Ivan Utkin', 'Yuri Utkin').
parent('Nina Kovaleva', 'Yuri Utkin').
parent('Anatoly Maslenkov', 'Zoya Maslenkova').
parent('Anna Emelkina', 'Zoya Maslenkova').
parent('Anatoly Maslenkov', 'Galina Maslenkova').
parent('Anna Emelkina', 'Galina Maslenkova').
parent('Anatoly Maslenkov', 'Anatol Maslenkov').
parent('Anna Emelkina', 'Anatol Maslenkov').
parent('Anatoly Maslenkov', 'Vyacheslav Maslenkov').
parent('Anna Emelkina', 'Vyacheslav Maslenkov').
parent('Anatoly Maslenkov', 'Alexandr Maslenkov').
parent('Anna Emelkina', 'Alexandr Maslenkov').
parent('Nikolay Veltman', 'Pavel Veltman').
parent('Evgenia Dobrecova', 'Pavel Veltman').
parent('Nikolay Veltman', 'Oleg Veltman').
parent('Evgenia Dobrecova', 'Oleg Veltman').
parent('Nikolay Veltman', 'Alexandr Veltman').
parent('Evgenia Dobrecova', 'Alexandr Veltman').
parent('Grigory Romanenko', 'Victor Romanenko').
parent('Valentina Romanenko', 'Victor Romanenko').
parent('Grigory Romanenko', 'Lida Romanenko').
parent('Valentina Romanenko', 'Lida Romanenko').
parent('Dmitry Biryukov', 'Ulyana Biryukova').
parent('Elena Veltman', 'Ulyana Biryukova').
parent('Oleg Veltman', 'Gleb Veltman').
parent('Gulnara Bakaeva', 'Gleb Veltman').
parent('Alexandr Veltman', 'Dmitry Veltman').
parent('Larisa Veltman', 'Dmitry Veltman').
parent('Victor Alishkin', 'Pavel Alishkin').
parent('Galina Maslenkova', 'Pavel Alishkin').
parent('Vyacheslav Maslenkov', 'Anna Maslenkova').
parent('Natalya Kozyr', 'Anna Maslenkova').
parent('Anatol Maslenkov', 'Alexey Maslenkov').
parent('Alla Kuznecova', 'Alexey Maslenkov').
parent('Anatol Maslenkov', 'Anastasia Maslenkova').
parent('Alla Kuznecova', 'Anastasia Maslenkova').
parent('Gleb Veltman', 'Elizaveta Veltman').
parent('Lira Bagirova', 'Elizaveta Veltman').
parent('Gleb Veltman', 'Lev Veltman').
parent('Lira Bagirova', 'Lev Veltman').
parent('Alexandr Maslenkov', 'Sergey Maslenkov').
parent('Svetlana Lvova', 'Sergey Maslenkov').
parent('Alexandr Maslenkov', 'Tatyana Maslenkova').
parent('Svetlana Lvova', 'Tatyana Maslenkova').
parent('Elena Tuz', 'Alexey Maslenkov').
parent('Elena Tuz', 'Anastasia Maslenkova').
parent('Mihail Emelkin', 'Anna Emelkina').
parent('Marfa Ivanova', 'Anna Emelkina').
parent('Mihail Emelkin', 'Evdokia Emelkina').
parent('Marfa Ivanova', 'Evdokia Emelkina').
parent('Mihail Emelkin', 'Ekaterina Emelkina').
parent('Marfa Ivanova', 'Ekaterina Emelkina').
parent('Mihail Emelkin', 'Alexey Emelkin').
parent('Marfa Ivanova', 'Alexey Emelkin').
parent('Pavel Alishkin', 'Timur Alishkin').
parent('Elena Butrimova', 'Timur Alishkin').
parent('Vadim Kovalev', 'Artem Kovalev').
parent('Elena Butrimova', 'Artem Kovalev').
sex('Nina Kovaleva', 'female').
sex('Ivan Utkin', 'male').
sex('Anna Emelkina', 'female').
sex('Anatoly Maslenkov', 'male').
sex('Galina Maslenkova', 'female').
sex('Anatol Maslenkov', 'male').
sex('Vyacheslav Maslenkov', 'male').
sex('Alexandr Maslenkov', 'male').
sex('Yuri Utkin', 'male').
sex('Nikolay Veltman', 'male').
sex('Grigory Romanenko', 'male').
sex('Valentina Romanenko', 'female').
sex('Ulyana Biryukova', 'female').
sex('Dmitry Biryukov', 'male').
sex('Oleg Veltman', 'male').
sex('Alexandr Veltman', 'male').
sex('Gleb Veltman', 'male').
sex('Dmitry Veltman', 'male').
sex('Larisa Veltman', 'female').
sex('Evgenia Dobrecova', 'female').
sex('Pavel Alishkin', 'male').
sex('Victor Alishkin', 'male').
sex('Anna Maslenkova', 'female').
sex('Natalya Kozyr', 'female').
sex('Alla Kuznecova', 'female').
sex('Gulnara Bakaeva', 'female').
sex('Lira Bagirova', 'female').
sex('Elizaveta Veltman', 'female').
sex('Elena Tuz', 'female').
sex('Svetlana Lvova', 'female').
sex('Sergey Maslenkov', 'male').
sex('Tatyana Maslenkova', 'female').
sex('Alexey Maslenkov', 'male').
sex('Anastasia Maslenkova', 'female').
sex('Mihail Emelkin', 'male').
sex('Marfa Ivanova', 'female').
sex('Lev Veltman', 'male').
sex('Elena Butrimova', 'female').
sex('Vadim Kovalev', 'male').
sex('Artem Kovalev', 'male').
sex('Timur Alishkin', 'male').
sex('Lida Romanenko', 'female').
sex('Evdokia Emelkina', 'female').
sex('Ekaterina Emelkina', 'female').
sex('Alexey Emelkin', 'male').
sex('Yaroslav Veltman', 'male').
sex('Tatyana Romanenko', 'female').
sex('Lina Veltman', 'female').
sex('Zoya Maslenkova', 'female').
sex('Victor Romanenko', 'male').
sex('Natalya Utkina', 'female').
sex('Pavel Veltman', 'male').
sex('Velizar Veltman', 'male').
sex('Elena Veltman', 'female').

sibling(Sibling, Person):-
parent(P, Person),
parent(P, Sibling),
Person \= Sibling.

cousin(Cousin, Person):-
parent(P1, Person),
parent(P2, Cousin),
sibling(P1, P2),
sex(Cousin, 'male'),
Person \= Cousin.

% Степень родства

check_link(Mother, Child, mother) :-
	parent(Mother, Child),
	sex(Mother, 'female').

check_link(Father, Child, father) :-
	parent(Father, Child),
	sex(Father, 'male').

check_link(Daughter, Parent, daughter) :-
	parent(Parent, Daughter),
	sex(Daughter, 'female').

check_link(Son, Parent, son) :-
	parent(Parent, Son),
	sex(Son, 'male').

check_link(Sister, Y, sister) :- 
	sibling(Y, Sister),
	sex(Sister, 'female').

check_link(Brother, Y, brother) :-
	sibling(Y, Brother),
	sex(Brother, 'male').

check_link(Wife, Husband, wife) :- 
	parent(Wife, Child),
	parent(Husband, Child),
	Husband \= Wife,
	sex(Wife, 'female').

check_link(Husband, Wife, husband) :- 
	parent(Wife, Child),
	parent(Husband, Child),
	Husband \= Wife,
	sex(Husband, 'male').

check_relation(X) :-
	member(X, [father, mother, sister, brother, daughter, son, wife, husband]).

ask_relative(X , Y, Res):- % цепочка родства, через которую связаны 2 человека
    check_relation(Res),!,
    check_link(X, Y, Res).

relative(X, Y, Res) :-
	search_iter(X, Y, Res), !.

% Вопросы о степени родства

question_word(X) :- member(X, [how, who, "How", "Who"]).

quantity(X) :- member(X,[much, many]).

relatives(X) :- member(X, [sisters, brothers, sons, daughters]).
famber(sister, sisters).
famber(brother, brothers).
famber(son, sons).
famber(daughter, daughters).

help_word(X) :- member(X, [do, does]).

have_has(X) :- member(X, [have, has]).

is(X) :- member(X, [is]).

apostrophe(X) :- member(X, ["'s"]).

question_mark(X) :- member(X, ['?']).

pronouns(X) :- member(X, [his, her, he, she]).

/* how many <relatives> does '<name>' have ? */
ask(List) :-
    List = [A, B, C, D, E, F, G],
    question_word(A), quantity(B), relatives(C), help_word(D),
    (sex(E, 'female'); sex(E, 'male')), nb_setval(lastName, E),
    have_has(F), question_mark(G),

    famber(C1, C),
    setof(X, ask_relative(X, E, C1), L),
    length(L, Res),
    write(E), write(" has "),
    ((Res =:= 1, write(Res), write(" "), write( C1));
    (\+(Res =:= 1), write(Res), write(" "), write( C))), !.

/* how many <relative> does <pronouns> have ? */
ask(List) :-
    List = [A, B, C1, D, E1, F, G],
    question_word(A), quantity(B), relatives(C1), help_word(D),
    pronouns(E1), nb_getval(lastName, E),
    have_has(F), question_mark(G),

    famber(C, C1),
    setof(X, ask_relative(X, E, C), L),
    length(L, Res),
    write(E), write(" has "),
    ((Res =:= 1, write(Res), write(" "), write(C));
    (\+(Res =:= 1), write(Res), write(" "), write(C1))), !.

/* who is '<name>' 's <relation> ? */
ask(List) :-
    List = [A, B, C, D, E, F],
    question_word(A), is(B),
    (sex(C, 'female'); sex(C, 'male')), nb_setval(lastName, C),
    apostrophe(D), check_relation(E), question_mark(F), !,
    check_link(Res, C, E),
    write(Res), write(" is "), write(C), write("'s "), write(E).

/* who is <pronouns> <relation> ? */
ask(List) :-
    List = [A, B, C1, D, E],
    question_word(A), is(B),
    pronouns(C1), nb_getval(lastName, C),
    check_relation(D), question_mark(E), !,
    check_link(C, Res, D),
    write(Res), write(" is "), write(C), write("'s "), write(D).

/* is '<name>' '<name>' 's <relation> ? */
ask(List) :-
    List = [A, B, C, D, E, F],
    nb_setval(lastName, C), is(A),
    (sex(B, 'female'); sex(B, 'male')),
    (sex(C, 'female'); sex(C, 'male')),
    apostrophe(D), check_relation(E),
    question_mark(F), check_link(B, C, E), !.

/* is '<name>' <pronouns> <relation> ? */
ask(List) :-
    List = [A, B, C1, D, E],
    is(A), (sex(B, 'female'); sex(B, 'male')),
    pronouns(C1), check_relation(D),
    question_mark(E),
    nb_getval(lastName, C), check_link(B, C, D), !.

/* Analysis */
/* who is '<name>' 's <relation> ? */
/* is '<name>' '<name>' 's <relation> ? */
analysis(List, Res) :-
    append(L1, L2, List),
    typeofquestion(L1, S),
    append(M1, M2, L2),
    name(M1, S1),
    append(N1, N2, M2),
    relationship(N1, S2),
    markofquestion(N2, S3),
    Res = sentence(S, S1, S2, S3).

/* how many <relation> does '<name>' have ? */

analysis(List, Res) :-
    List = [A, B, C, D, E, F, G],
    typeofquestion([A, B], T),
    relationship([C], T1),
    helpword([D], T2),
    name([E], T3),
    havehas([F], T4),
    markofquestion([G], T5),
    Res = sentence(T, T1, T2, T3, T4, T5).

typeofquestion(L, type_of_question(X, Y)) :-
    question_word(X1), is(Y1),
    L = [X1, Y1],
    X = questionWord(X1),
    Y = auxiliaryVerb(Y1).

typeofquestion(L, type_of_question(X, Y)) :-
    question_word(X1), quantity(Y1),
    L = [X1, Y1],
    X = questionWord(X1),
    Y = much_many(Y1).

typeofquestion(L, type_of_question(X)) :-
    is(X1),
    L = [X1],
    X = auxiliaryVerb(X1).

name(L, names(X)) :-
    L = [X1, Y1],
    ((sex(X1, 'female'); sex(X1, 'male')); (pronouns(X1))),
    apostrophe(Y1),
    X = person(X1, Y1).

name(L, names(X)) :-
    L = [X1],
    ((sex(X1, 'female'); sex(X1, 'male')); (pronouns(X1))),
    X = person(X1).

name(L, names(X, Y)) :-
    L = [X1, Y1, Z1],
    ((sex(X1, 'female'); sex(X1, 'male'))),
    ((sex(Y1, 'female'); sex(Y1, 'male')); (pronouns(Y1))),
    apostrophe(Z1),
    X = person(X1),
    Y = relative_(Y1, Z1).

relationship([X], Res) :-
    relatives(X),
    Res = relationship_(X).

relationship([X], Res) :-
    check_relation(X),
    Res = relationship_(X).

havehas([X], Res) :-
    have_has(X),
    Res = haveHas(X).

helpword([X], Res) :-
    help_word(X),
    Res = helpWord(X).

markofquestion([X], Res) :-
    question_mark(X),
    Res = mark_of_question(X).
